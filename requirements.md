# Sigma BF カメラファイルコピーアプリケーション 要件定義書

## 1. 概要
Sigma BFカメラからUSB接続で写真・動画を自動的にWindowsパソコンにコピーするアプリケーション

## 2. 基本機能要件

### 2.1 USB自動検知機能
- USB接続されたSigma BFカメラの自動検知
- カメラ接続時の自動認識とユーザー通知
- マスストレージデバイスとしての認識

### 2.2 フォルダ単位コピー機能
- カメラ内フォルダの選択的コピー
- DCIMフォルダ内の日付フォルダ（例：250518_0）から選択
- 選択フォルダ内ファイル全体の一括コピー
- ファイル単位選択は不要
- 写真と動画の自動分類・分離

### 2.3 カメラフォルダ構造認識
- **ドライブラベル**: "Sigma BF"として認識
- **基本パス**: `[ドライブ]:\DCIM\`
- **日付フォルダ**: `YYMMDD_N`形式（例：250518_0, 250518_1）
- **対応ファイル**: DNG, JPG, MOV混在フォルダ

### 2.4 フォルダ構造とネーミング
#### コピー先フォルダ命名規則
- 形式：`YYYY-MM-DD_(ユーザー指定名)`
- 写真用フォルダと動画用フォルダを別々に作成
- 各フォルダ内に機種名「BF」サブフォルダを作成

#### フォルダ構造例
```
コピー先/
├── 2024-01-15_旅行写真/
│   └── BF/
│       ├── IMG001.jpg
│       └── IMG002.raw
└── 2024-01-15_旅行動画/
    └── BF/
        ├── VID001.mp4
        └── VID002.mov
```

### 2.5 設定保持機能
- **写真コピー先**: フォルダパスの保存・復元
- **動画コピー先**: フォルダパスの保存・復元  
- **前回フォルダ名**: 前回入力したフォルダ名の保持（参考用）
- **初回設定フラグ**: 初回起動判定用
- **自動設定読み込み**: アプリ起動時の設定復元
- **設定変更UI**: 必要に応じて設定を変更可能

## 3. ユーザーインターフェース要件

### 3.1 基本UI
- **カメラフォルダ選択**: DCIMフォルダ内の日付フォルダ一覧表示・選択
- **フォルダ名入力**: コピー先フォルダ名の指定ダイアログ
- **設定画面**: 写真・動画コピー先フォルダの設定変更
- **進行状況表示**: 選択フォルダのコピー進行状況
- **設定リセット機能**: 保存設定のクリア

### 3.2 操作フロー

#### 初回起動時
1. アプリ起動
2. **初期設定ダイアログ表示**（写真・動画コピー先フォルダ指定を促す）
3. 設定保存後、通常操作へ

#### 通常操作時
1. アプリ起動（前回設定自動読み込み）
2. カメラUSB接続（自動検知）
3. **カメラフォルダ選択**（DCIM内の日付フォルダから選択）
4. フォルダ名入力
5. コピー実行・進捗確認

#### 設定変更時
- メニューまたは設定ボタンから設定画面を開く
- 写真・動画コピー先フォルダの変更
- 設定保存・適用

## 4. 技術仕様

### 4.1 対応環境
- **OS**: Windows 10/11
- **接続方式**: USB（マスストレージ）
- **.NET Framework**: 4.8以上推奨

### 4.2 対応ファイル形式
- **写真**: DNG（RAW）, JPG
- **動画**: MOV
- **自動分類**: 拡張子による写真・動画の自動振り分け

### 4.3 USB検知技術
- Windows Management Instrumentation (WMI)
- Win32_LogicalDisk監視
- DeviceChangeイベント処理
- **ドライブラベル識別**: "Sigma BF"ラベルでの自動認識
- **DCIMフォルダ検索**: `\DCIM\`フォルダ存在確認

### 4.4 設定保存
- **保存場所**: `%APPDATA%\SigmaBFCopy\config.json`
- **形式**: JSON
- **保存項目**:
  - photoDestination（写真保存先）
  - videoDestination（動画保存先）
  - lastFolderName（前回フォルダ名）
  - isFirstRun（初回起動フラグ）

## 5. エラーハンドリング

### 5.1 USB接続関連
- カメラ未検知時の適切なメッセージ表示
- 接続切断時の処理中断・復旧

### 5.2 ファイルコピー関連
- 容量不足時の警告
- 同名フォルダ存在時の処理選択
- コピー失敗時のリトライ機能

### 5.3 設定関連
- 設定ファイル破損時のデフォルト値復旧
- 指定パス不存在時のフォルダ作成または再選択

## 6. パフォーマンス要件
- USB 3.0対応による高速転送
- 大容量ファイル対応
- UI応答性維持（バックグラウンド処理）
- メモリ効率的な処理

## 7. セキュリティ・制限事項
- ローカルファイルアクセスのみ
- ネットワーク機能なし
- 管理者権限不要での動作
- MTPモード非対応（マスストレージのみ）